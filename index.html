<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClipFlow | Prototipo Profesional</title>
    <style>
        :root {
            --primary: #8a2be2;
            --secondary: #00f2ea;
            --bg-dark: #050505;
            --card-bg: #121212;
            --text-light: #ffffff;
            --text-dim: #b0b0b0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #000; color: white; height: 100vh; display: flex; justify-content: center; overflow: hidden; }

        #app-container {
            width: 100%; max-width: 450px; height: 100vh;
            position: relative; background: var(--bg-dark); display: flex; flex-direction: column;
        }

        /* --- AJUSTE DE SCROLL TIPO TIKTOK --- */
        #feed { 
            flex: 1; 
            overflow-y: scroll; 
            /* Esto obliga a que el scroll se pegue al inicio del contenedor hijo */
            snap-type: y mandatory; 
            scrollbar-width: none; 
            -webkit-overflow-scrolling: touch;
        }
        #feed::-webkit-scrollbar { display: none; }

        .video-player {
            width: 100%; 
            height: 100%; 
            /* Snap-align start hace que el video se ajuste autom√°ticamente */
            snap-align: start; 
            snap-stop: always;
            position: relative;
            background: #000; 
            display: flex; 
            align-items: center;
        }
        video { width: 100%; height: 100%; object-fit: cover; }

        /* --- ESTADO VAC√çO CON CLAQUETA --- */
        #empty-state {
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px;
            background: radial-gradient(circle at center, #1a0b2e 0%, #050505 100%);
        }
        .empty-icon {
            font-size: 100px;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 15px var(--primary));
            animation: floating 3s ease-in-out infinite;
        }
        @keyframes floating {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        /* --- PANTALLA LOGIN --- */
        #auth-screen {
            position: absolute; inset: 0; z-index: 5000;
            background: linear-gradient(135deg, #000 0%, #2e004d 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px;
        }
        .login-card { width: 100%; text-align: center; }
        .login-card h1 { font-size: 3rem; color: var(--secondary); margin-bottom: 10px; }
        .login-card input {
            width: 100%; padding: 15px; margin-bottom: 15px; border-radius: 12px;
            border: 1px solid #333; background: rgba(255,255,255,0.1); color: white; outline: none;
        }

        /* --- INTERFAZ SOBRE VIDEO --- */
        .ui-overlay {
            position: absolute; inset: 0; pointer-events: none;
            display: flex; flex-direction: column; justify-content: flex-end;
            padding: 20px; background: linear-gradient(0deg, rgba(0,0,0,0.8) 0%, transparent 40%);
        }
        .side-bar {
            position: absolute; right: 12px; bottom: 100px;
            display: flex; flex-direction: column; align-items: center; gap: 18px; pointer-events: auto;
        }
        .profile-btn { 
            width: 48px; height: 48px; border-radius: 50%; border: 2px solid white; 
            overflow: hidden; margin-bottom: 10px; background: #333;
        }
        .profile-btn img { width: 100%; height: 100%; object-fit: cover; }
        
        .action-btn { background: none; border: none; color: white; cursor: pointer; text-align: center; }
        .action-btn span { display: block; font-size: 12px; font-weight: bold; margin-top: 4px; }

        .video-info { pointer-events: auto; margin-bottom: 60px; max-width: 80%; }
        .video-info h4 { color: var(--secondary); margin-bottom: 6px; font-size: 1.1rem; }

        /* --- ANIMACI√ìN LIKE --- */
        .heart-pop {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 100px; color: var(--primary); opacity: 0; pointer-events: none;
        }
        @keyframes pop {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.3); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }

        /* --- MODAL GRABACI√ìN --- */
        .modal {
            position: absolute; inset: 0; background: #000;
            z-index: 4000; display: none; flex-direction: column; padding: 20px;
        }
        .modal-active { display: flex; }
        #recorder-preview { width: 100%; height: 60%; background: #111; border-radius: 20px; object-fit: cover; transform: scaleX(-1); }
        .rec-circle { width: 70px; height: 70px; border-radius: 50%; border: 5px solid white; background: red; cursor: pointer; }
        .rec-circle.recording { border-radius: 10px; animation: pulse 1s infinite; }

        /* --- GENERAL --- */
        .btn-primary { background: var(--primary); color: white; border: none; padding: 16px; border-radius: 12px; font-weight: bold; cursor: pointer; }
        nav { height: 75px; background: #000; border-top: 1px solid #222; display: flex; justify-content: space-around; align-items: center; }
        .upload-center { background: linear-gradient(90deg, var(--secondary), var(--primary)); width: 50px; height: 32px; border-radius: 10px; color: black; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.4rem; }
        .beta-text { opacity: 0.3; font-size: 11px; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="app-container">
        <div id="auth-screen">
            <div class="login-card">
                <h1>ClipFlow</h1>
                <input type="text" id="login-user" placeholder="Tu nombre de usuario">
                <button class="btn-primary" style="width:100%" onclick="handleLogin()">Entrar</button>
                <p class="beta-text">VERSION BETA V0.5 - PROTOTIPO DE DESARROLLO</p>
            </div>
        </div>

        <main id="feed" style="display: none;"></main>

        <div id="empty-state">
            <div class="empty-icon">üé¨</div>
            <h2 style="color: var(--secondary)">S√© el primero en brillar</h2>
            <p style="color: var(--text-dim); margin: 15px 0;">El feed est√° esperando tu talento. Graba tu primer video.</p>
            <button class="btn-primary" style="padding: 10px 30px;" onclick="openModal()">Subir Video</button>
            <p class="beta-text">Aviso: Versi√≥n prototipo. Es algo muy beta.</p>
        </div>

        <div id="upload-modal" class="modal">
            <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3>C√°mara ClipFlow</h3>
                <button onclick="closeModal()" style="background:none; color:white; border:none; font-size: 24px;">‚úï</button>
            </div>
            <video id="recorder-preview" autoplay muted playsinline></video>
            <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:15px;">
                <div id="rec-btn" class="rec-circle" onclick="toggleRecording()"></div>
                <div id="post-actions" style="display:none; width:100%;">
                    <input type="text" id="video-desc" placeholder="¬øDe qu√© trata tu video?" style="width: 100%; padding: 15px; border-radius: 12px; background: #222; border: 1px solid #333; color: white; margin-bottom: 10px;">
                    <button class="btn-primary" style="width:100%" onclick="publishVideo()">üöÄ Publicar ahora</button>
                </div>
            </div>
        </div>

        <nav>
            <div onclick="playSound('click')" style="cursor:pointer">üè†</div>
            <div onclick="openModal()"><div class="upload-center">+</div></div>
            <div onclick="playSound('click')" style="cursor:pointer">üë§</div>
        </nav>
    </div>

    <audio id="snd-click" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>
    <audio id="snd-pop" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>
    <audio id="snd-success" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>

    <script>
        let currentUser = "Invitado";
        let mediaRecorder;
        let recordedChunks = [];
        let stream;

        function playSound(id) {
            const s = document.getElementById('snd-' + id);
            if(s) { s.currentTime = 0; s.play().catch(()=>{}); }
        }

        function handleLogin() {
            const user = document.getElementById('login-user').value;
            if(user.trim()) currentUser = user;
            playSound('success');
            document.getElementById('auth-screen').style.display = 'none';
        }

        async function openModal() {
            playSound('click');
            document.getElementById('upload-modal').classList.add('modal-active');
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                document.getElementById('recorder-preview').srcObject = stream;
            } catch (err) { alert("Acceso a c√°mara denegado."); }
        }

        function closeModal() {
            if(stream) stream.getTracks().forEach(t => t.stop());
            document.getElementById('upload-modal').classList.remove('modal-active');
            document.getElementById('post-actions').style.display = 'none';
            document.getElementById('rec-btn').style.display = 'block';
        }

        function toggleRecording() {
            const btn = document.getElementById('rec-btn');
            if (mediaRecorder && mediaRecorder.state === "recording") {
                mediaRecorder.stop();
                btn.classList.remove('recording');
                playSound('click');
            } else {
                recordedChunks = [];
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.ondataavailable = e => recordedChunks.push(e.data);
                mediaRecorder.onstop = () => {
                    document.getElementById('post-actions').style.display = 'block';
                    btn.style.display = 'none';
                };
                mediaRecorder.start();
                btn.classList.add('recording');
                playSound('pop');
            }
        }

        function publishVideo() {
            const blob = new Blob(recordedChunks, { type: 'video/webm' });
            const url = URL.createObjectURL(blob);
            const desc = document.getElementById('video-desc').value || "Clip Flow! ‚ú®";

            const post = document.createElement('div');
            post.className = 'video-player';
            post.innerHTML = `
                <video src="${url}" loop playsinline></video>
                <div class="heart-pop">‚ù§Ô∏è</div>
                <div class="ui-overlay">
                    <div class="side-bar">
                        <div class="profile-btn"><img src="https://ui-avatars.com/api/?name=${currentUser}&background=random"></div>
                        <button class="action-btn" onclick="toggleLike(this)"><div class="icon" style="font-size:30px">ü§ç</div><span class="l-count">0</span></button>
                        <button class="action-btn" onclick="alert('Comentarios beta')"><div style="font-size:30px">üí¨</div><span>0</span></button>
                    </div>
                    <div class="video-info"><h4>@${currentUser.toLowerCase()}</h4><p>${desc}</p></div>
                </div>
            `;

            post.addEventListener('dblclick', function() { toggleLike(this.querySelector('.action-btn'), true); });
            
            const feed = document.getElementById('feed');
            feed.prepend(post);
            feed.style.display = 'block';
            document.getElementById('empty-state').style.display = 'none';
            
            playSound('success');
            closeModal();
            initObserver();
        }

        function toggleLike(btn, force = false) {
            const icon = btn.querySelector('.icon');
            const count = btn.querySelector('.l-count');
            const heart = btn.closest('.video-player').querySelector('.heart-pop');
            if(icon.innerText === "ü§ç" || force) {
                if(icon.innerText === "ü§ç") count.innerText = parseInt(count.innerText) + 1;
                icon.innerText = "‚ù§Ô∏è"; icon.style.color = "var(--secondary)";
                playSound('pop');
                heart.style.animation = 'none'; heart.offsetHeight; heart.style.animation = 'pop 0.6s ease-out';
            } else {
                icon.innerText = "ü§ç"; icon.style.color = "white";
                count.innerText = Math.max(0, parseInt(count.innerText) - 1);
            }
        }

        function initObserver() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const v = entry.target.querySelector('video');
                    if(entry.isIntersecting) v.play().catch(()=>{});
                    else { v.pause(); v.currentTime = 0; }
                });
            }, { threshold: 0.6 });
            document.querySelectorAll('.video-player').forEach(p => observer.observe(p));
        }

        document.getElementById('feed').addEventListener('click', e => {
            if(e.target.tagName === 'VIDEO') e.target.paused ? e.target.play() : e.target.pause();
        });
    </script>
</body>
</html>